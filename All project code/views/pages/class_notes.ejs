<%- include ('../partials/head') %>
<%- include ('../partials/menu') %>


<main>
    <div class="row">
        <div class="col-6 mx-auto">
            <form>
                <div class="input-group">
                    <input type="text" id="search" class="form-control" placeholder="Search">
                </div>
            </form>
        </div>
    </div>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col">
          <div class="d-flex flex-wrap justify-content-center">
              <div class="clicktable-rect" data-index="1000">CSCI 1000</div>
              <div class="clicktable-rect" data-index="1200">CSCI 1200</div>
              <div class="clicktable-rect" data-index="1300">CSCI 1300</div>
              <div class="clicktable-rect" data-index="2270">CSCI 2270</div>
              <div class="clicktable-rect" data-index="2275">CSCI 2275</div>
              <div class="clicktable-rect" data-index="2400">CSCI 2400</div>
              <div class="clicktable-rect" data-index="2750">CSCI 2750</div>
              <div class="clicktable-rect" data-index="2820">CSCI 2820</div>
              <div class="clicktable-rect" data-index="2824">CSCI 2824</div>
              <div class="clicktable-rect" data-index="2830">CSCI 2830</div>
          </div>
      </div>
    </div>
</main>


<style>
.input-group {
  max-width: 300px;
  margin: 20px auto;
  margin-top: 25px;
  border-bottom: 1px solid #000000;
}

.form-control {
  border: none;
}

.form-control:focus {
  box-shadow: none;
  border-color: transparent;
}

.clicktable-rect {
  width: 100px;
  height: 50px;
  background-color: #ffffff;
  color: #000000;
  border: .5px solid #000000;
  font-weight: bold;
  font-size: 1.2rem;
  text-align: center;
  margin: 5px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  border-radius: 5px;
  line-height: 50px;
  font-size: 14px;
}

.clicktable-rect:hover {
  transform: scale(1.05);
  box-shadow: 0px 0px 5px #000000;
  transition: box-shadow 0.1s ease-in-out;
}

.modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.4);
}

.modal-title {
  margin-bottom: 20px;
  font-size: 1.5rem;
}


.modal-content {
  background-color: #fefefe;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  max-width: 600px;
}

.card {
  background-color: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 5px;
  padding: 10px;
  margin: 10px;
  cursor: pointer;
}

.card:hover {
  box-shadow: 0px 0px 5px #000000;
  transition: box-shadow 0.1s ease-in-out;
}

.card-title {
  font-weight: bold;
  font-size: 1.2rem;
  margin-bottom: 5px;
}

.card-content {
  font-size: 1rem;
}
</style>


<script>
  const search = document.getElementById('search');
  const clicktableRects = document.querySelectorAll('.clicktable-rect');

  search.addEventListener('input', () => {
    const searchTerm = search.value.toLowerCase();

    clicktableRects.forEach((rect) => {
      const courseCode = rect.textContent.toLowerCase();
      if (courseCode.includes(searchTerm)) {
        rect.style.display = 'block';
        rect.classList.add('search-match');
      } else {
        rect.style.display = 'none';
        rect.classList.remove('search-match');
      }
    });
  });

  // Create modals
  clicktableRects.forEach((rect) => {
    const index = rect.getAttribute('data-index');
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.id = `modal${index}`;
    const modalContent = document.createElement('div');
    modalContent.className = 'modal-content';

    fetchNotes(index, modalContent);

    const modalTitle = document.createElement('h2');
    modalTitle.className = 'modal-title';
    modalTitle.textContent = rect.textContent;
    modalContent.appendChild(modalTitle);


    // const courseInfo = document.createElement('div');
    // courseInfo.className = 'card';
    // const courseTitle = document.createElement('div');
    // courseTitle.className = 'card-title';
    // courseTitle.textContent = `Class Note`;
    // courseInfo.appendChild(courseTitle);
    // const courseDescription = document.createElement('div');
    // courseDescription.className = 'card-content';
    // courseDescription.textContent = `Class Note Content`;
    // courseInfo.appendChild(courseDescription);
    // modalContent.appendChild(courseInfo);

    const addCardButton = document.createElement('button');
    addCardButton.textContent = '+ Add New Class Note';
    addCardButton.style.marginTop = '10px';
    addCardButton.style.width = '100%';
    addCardButton.style.padding = '10px';
    addCardButton.style.backgroundColor = '#007bff';
    addCardButton.style.color = '#ffffff';
    addCardButton.style.border = 'none';
    addCardButton.style.borderRadius = '5px';
    addCardButton.style.cursor = 'pointer';

  // ...
addCardButton.addEventListener('click', () => {
  const newCardTitleText = prompt('Enter the title of the new class note:');
  const newCardContentText = prompt('Enter the content of the new class note:');
  
  const newCard = createCard(newCardTitleText, newCardContentText);
  modalContent.insertBefore(newCard, addCardButton);

  // Send a POST request to the server to store the new note in the database
  fetch('/notes', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      course_id: index,
      title: newCardTitleText,
      content: newCardContentText
    })
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
  })
  .catch(error => {
    console.error('There was a problem with the fetch operation:', error);
  });
});



  modalContent.appendChild(addCardButton);

  modal.appendChild(modalContent);
  document.body.appendChild(modal);

  rect.addEventListener('click', () => {
    modal.style.display = 'block';
  });

  window.addEventListener('click', (event) => {
    if (event.target === modal) {
      modal.style.display = 'none';
    }
  });


function createCard(title, content) {
  const card = document.createElement('div');
  card.className = 'card';

  const cardTitle = document.createElement('div');
  cardTitle.className = 'card-title';
  cardTitle.textContent = title;
  card.appendChild(cardTitle);

  const cardContent = document.createElement('div');
  cardContent.className = 'card-content';
  
  const truncatedContent = content.substring(0, 25) + (content.length > 25 ? '...' : '');
  cardContent.textContent = truncatedContent;
  
  card.appendChild(cardContent);

  return card;
}

function fetchNotes(course_id, modalContent) {
  fetch(`/notes/${course_id}`)
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(notes => {
      notes.forEach(note => {
        const newCard = createCard(note.title, note.content);
        modalContent.insertBefore(newCard, modalContent.querySelector('button'));
      });
    })
    .catch(error => {
      console.error('There was a problem with the fetch operation:', error);
    });
}
});

</script>


<%- include ('../partials/footer') %>